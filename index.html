<!DOCTYPE html>
<html lang="es" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inner Rhythm</title>
    <script src="/_sdk/element_sdk.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@100;200;300;400&amp;display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Outfit", sans-serif;
        font-weight: 300;
        letter-spacing: 0.02em;
      }

      html,
      body,
      #app-container {
        height: 100%;
        width: 100%;
      }

      #app-container {
        position: relative;
        overflow: hidden;
      }

      .screen {
        position: absolute;
        inset: 0;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1),
          visibility 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 3rem 2rem;
        overflow-y: auto;
      }

      .screen.active {
        opacity: 1;
        visibility: visible;
      }

      #monitor-screen {
        background: linear-gradient(
          165deg,
          #0f1720 0%,
          #1e2a38 50%,
          #2a3f50 100%
        );
      }

      .app-header {
        position: absolute;
        top: 2rem;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.8rem;
      }

      .app-logo {
        width: 100px;
        height: 100px;
        object-fit: contain;
        opacity: 0.95;
        animation: fadeInDown 0.8s ease-out;
      }

      .app-title {
        font-size: 0.75rem;
        letter-spacing: 0.15em;
        text-transform: uppercase;
        color: rgba(255, 255, 255, 0.25);
        font-weight: 200;
        margin: 0;
        animation: fadeInUp 0.8s ease-out 0.1s backwards;
      }

      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 0.95;
          transform: translateY(0);
        }
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .pulse-container {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 280px;
        height: 280px;
      }

      .pulse-ring {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: radial-gradient(
          circle at 30% 30%,
          rgba(78, 140, 135, 0.2),
          rgba(78, 140, 135, 0.05)
        );
        animation: expand 1.6s ease-out infinite;
      }

      .pulse-ring:nth-child(2) {
        animation-delay: 0.3s;
      }

      .pulse-ring:nth-child(3) {
        animation-delay: 0.6s;
      }

      @keyframes expand {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        100% {
          transform: scale(2.2);
          opacity: 0;
        }
      }

      .pulse-circle {
        position: relative;
        z-index: 10;
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: linear-gradient(135deg, #4e8c87 0%, #c9c7e8 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 20px 60px rgba(78, 140, 135, 0.3);
        animation: subtle-pulse 1.6s ease-in-out infinite;
      }

      @keyframes subtle-pulse {
        0%,
        100% {
          transform: scale(1);
          box-shadow: 0 20px 60px rgba(78, 140, 135, 0.3);
        }
        50% {
          transform: scale(1.08);
          box-shadow: 0 30px 80px rgba(78, 140, 135, 0.4);
        }
      }

      .pulse-icon {
        width: 90px;
        height: 90px;
        color: rgba(255, 255, 255, 0.9);
        animation: beat 1.6s ease-in-out infinite;
      }

      @keyframes beat {
        0%,
        100% {
          opacity: 0.8;
          transform: scale(1);
        }
        25% {
          opacity: 1;
          transform: scale(1.1);
        }
        50% {
          opacity: 0.8;
          transform: scale(1);
        }
      }

      .bpm-display {
        text-align: center;
      }

      .bpm-number {
        font-size: 5.5rem;
        font-weight: 100;
        color: #ffffff;
        line-height: 1;
        margin: 0;
        letter-spacing: -0.03em;
      }

      .bpm-label {
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.3);
        margin: 1rem 0 0 0;
        letter-spacing: 0.1em;
        font-weight: 200;
        text-transform: uppercase;
      }

      .state-indicator {
        position: absolute;
        bottom: 3rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      .state-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        transition: all 0.6s ease;
      }

      .state-dot.calm {
        background-color: #4e8c87;
        box-shadow: 0 0 10px rgba(78, 140, 135, 0.4);
      }

      .state-dot.active {
        background-color: #c9c7e8;
        box-shadow: 0 0 10px rgba(201, 199, 232, 0.4);
      }

      .state-text {
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.4);
        letter-spacing: 0.08em;
        text-transform: uppercase;
        font-weight: 200;
        transition: color 0.6s ease;
        margin: 0;
      }

      .breathe-btn {
        position: absolute;
        bottom: 2rem;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: rgba(255, 255, 255, 0.7);
        width: 56px;
        height: 56px;
        border-radius: 50%;
        padding: 0;
        cursor: pointer;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        font-family: "Outfit", sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 200;
        position: relative;
        overflow: hidden;
      }

      .breathe-btn::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        opacity: 0;
        animation: pulse-glow 2s ease-in-out infinite;
      }

      @keyframes pulse-glow {
        0%,
        100% {
          opacity: 0;
          transform: scale(1);
        }
        50% {
          opacity: 1;
          transform: scale(1.1);
        }
      }

      .breathe-btn:hover {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.2);
        color: rgba(255, 255, 255, 0.85);
        box-shadow: 0 8px 24px rgba(78, 140, 135, 0.2);
        transform: translateY(-2px);
      }

      .breathe-btn:active {
        transform: scale(0.95);
      }

      .breathe-icon {
        width: 24px;
        height: 24px;
        stroke: currentColor;
        stroke-width: 1.2;
        fill: none;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      #breathe-screen {
        background: linear-gradient(165deg, #4e8c87 0%, #c9c7e8 100%);
      }

      .breathe-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        width: 100%;
        position: relative;
      }

      .back-button {
        position: absolute;
        top: 2rem;
        left: 2rem;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: rgba(255, 255, 255, 0.5);
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: "Outfit", sans-serif;
        padding: 0;
      }

      .back-button:hover {
        background: rgba(255, 255, 255, 0.12);
        color: rgba(255, 255, 255, 0.7);
      }

      .back-icon {
        width: 18px;
        height: 18px;
        stroke: currentColor;
        stroke-width: 1.2;
        fill: none;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      .breathing-title {
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.25);
        letter-spacing: 0.15em;
        text-transform: uppercase;
        font-weight: 200;
        margin: 0;
      }

      .breathing-circle {
        width: 220px;
        height: 220px;
        border-radius: 50%;
        background: linear-gradient(135deg, #4e8c87 0%, #c9c7e8 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 30px 80px rgba(78, 140, 135, 0.25);
        transition: all 4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        margin-bottom: 3rem;
        position: relative;
      }

      .breathing-circle::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.05);
        animation: shimmer 3s ease-in-out infinite;
      }

      @keyframes shimmer {
        0%,
        100% {
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
      }

      .breathing-circle.inhale {
        transform: scale(1.3);
        background: linear-gradient(135deg, #4e8c87 0%, #c9c7e8 100%);
        box-shadow: 0 40px 100px rgba(78, 140, 135, 0.3);
      }

      .breathing-circle.exhale {
        transform: scale(0.8);
        background: linear-gradient(135deg, #4e8c87 0%, #c9c7e8 100%);
        box-shadow: 0 15px 40px rgba(78, 140, 135, 0.15);
      }

      .breathing-info {
        text-align: center;
      }

      .breathing-instruction {
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.6);
        letter-spacing: 0.08em;
        margin: 0 0 1.5rem 0;
        font-weight: 200;
        text-transform: uppercase;
      }

      .breathing-timer {
        font-size: 2rem;
        font-weight: 100;
        color: rgba(255, 255, 255, 0.85);
        margin: 0;
        line-height: 1;
      }

      .cycle-info {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        margin-top: 3.5rem;
      }

      .cycle-dots {
        display: flex;
        gap: 0.6rem;
      }

      .cycle-dot {
        width: 5px;
        height: 5px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.12);
        transition: all 0.4s ease;
      }

      .cycle-dot.active {
        background: rgba(255, 255, 255, 0.45);
        transform: scale(1.2);
      }

      .cycle-dot.completed {
        background: rgba(78, 140, 135, 0.7);
      }

      .cycle-label {
        font-size: 0.65rem;
        color: rgba(255, 255, 255, 0.25);
        letter-spacing: 0.08em;
        text-transform: uppercase;
        font-weight: 200;
        margin: 0;
      }

      .breathing-message {
        position: absolute;
        bottom: 2.5rem;
        max-width: 280px;
        text-align: center;
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.3);
        line-height: 1.7;
        font-weight: 200;
        opacity: 0;
        transition: opacity 0.8s ease;
        letter-spacing: 0.01em;
      }

      .breathing-message.visible {
        opacity: 1;
      }

      .menu-overlay {
        position: fixed;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 998;
        transition: left 0.3s ease;
        backdrop-filter: blur(3px);
      }

      .menu-overlay.active {
        left: 0;
      }

      .menu-sidebar {
        position: fixed;
        top: 0;
        left: -80%;
        width: 80%;
        max-width: 320px;
        height: 100%;
        background: linear-gradient(
          180deg,
          #0f1720 0%,
          #1e2a38 50%,
          #2a3f50 100%
        );
        z-index: 999;
        transition: left 0.3s ease;
        display: flex;
        flex-direction: column;
        padding: 2rem 0;
        overflow-y: auto;
      }

      .menu-sidebar.active {
        left: 0;
      }

      .menu-header {
        padding: 1.5rem 1.5rem 2rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .menu-logo-section {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex: 1;
      }

      .menu-logo {
        width: 40px;
        height: 40px;
        object-fit: contain;
        opacity: 0.9;
      }

      .menu-title {
        font-size: 1.1rem;
        font-weight: 300;
        color: #ffffff;
        letter-spacing: 0.08em;
        margin: 0;
      }

      .menu-close {
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.6);
        cursor: pointer;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        padding: 0;
        font-family: "Outfit", sans-serif;
      }

      .menu-close:hover {
        color: rgba(255, 255, 255, 0.9);
        transform: rotate(90deg);
      }

      .menu-close svg {
        width: 20px;
        height: 20px;
        stroke: currentColor;
        stroke-width: 1.5;
        fill: none;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      .menu-items {
        flex: 1;
        display: flex;
        flex-direction: column;
        list-style: none;
        margin: 0;
        padding: 1rem 0;
      }

      .menu-item {
        padding: 0;
      }

      .menu-link {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem 1.5rem;
        color: rgba(255, 255, 255, 0.6);
        text-decoration: none;
        font-size: 0.95rem;
        font-weight: 300;
        letter-spacing: 0.05em;
        transition: all 0.3s ease;
        border-left: 2px solid transparent;
        cursor: pointer;
        font-family: "Outfit", sans-serif;
        background: none;
        border: none;
        width: 100%;
        text-align: left;
      }

      .menu-link:hover {
        color: rgba(255, 255, 255, 0.9);
        background: rgba(78, 140, 135, 0.1);
        border-left-color: #4e8c87;
        padding-left: 2rem;
        transform: translateX(4px);
      }

      .menu-link.active {
        color: #ffffff;
        background: rgba(78, 140, 135, 0.2);
        border-left-color: #4e8c87;
        font-weight: 400;
      }

      .menu-icon {
        width: 20px;
        height: 20px;
        stroke: currentColor;
        stroke-width: 1.2;
        fill: none;
        stroke-linecap: round;
        stroke-linejoin: round;
        flex-shrink: 0;
      }

      .menu-toggle {
        position: fixed;
        top: 2rem;
        right: 2rem;
        background: rgba(78, 140, 135, 0.15);
        border: 1px solid rgba(78, 140, 135, 0.3);
        color: rgba(255, 255, 255, 0.7);
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 997;
        transition: all 0.3s ease;
        padding: 0;
        font-family: "Outfit", sans-serif;
      }

      .menu-toggle:hover {
        background: rgba(78, 140, 135, 0.25);
        border-color: rgba(78, 140, 135, 0.5);
        color: rgba(255, 255, 255, 0.9);
      }

      .menu-toggle svg {
        width: 22px;
        height: 22px;
        stroke: currentColor;
        stroke-width: 1.5;
        fill: none;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      .menu-toggle.open svg {
        transform: rotate(45deg);
      }

      #stats-screen {
        background: linear-gradient(
          165deg,
          #0f1720 0%,
          #1e2a38 50%,
          #2a3f50 100%
        );
      }

      .stats-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        width: 100%;
        gap: 2rem;
        padding: 3rem 2rem;
      }

      .stats-header {
        text-align: center;
      }

      .stats-title {
        font-size: 1.5rem;
        font-weight: 300;
        color: #ffffff;
        margin: 0 0 0.5rem 0;
        letter-spacing: 0.05em;
      }

      .stats-subtitle {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.4);
        letter-spacing: 0.1em;
        text-transform: uppercase;
        font-weight: 200;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
        width: 100%;
        max-width: 400px;
      }

      .stat-card {
        background: rgba(78, 140, 135, 0.1);
        border: 1px solid rgba(78, 140, 135, 0.2);
        border-radius: 12px;
        padding: 1.5rem 1rem;
        text-align: center;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .stat-card:hover {
        background: rgba(78, 140, 135, 0.15);
        border-color: rgba(78, 140, 135, 0.4);
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(78, 140, 135, 0.15);
      }

      .stat-value {
        font-size: 2rem;
        font-weight: 100;
        color: #4e8c87;
        margin: 0 0 0.5rem 0;
        line-height: 1;
      }

      .stat-label {
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.5);
        letter-spacing: 0.08em;
        text-transform: uppercase;
        font-weight: 200;
        margin: 0;
      }

      #settings-screen {
        background: linear-gradient(
          165deg,
          #0f1720 0%,
          #1e2a38 50%,
          #2a3f50 100%
        );
      }

      .settings-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        height: 100%;
        width: 100%;
        padding: 3rem 2rem 2rem;
        gap: 2rem;
      }

      .settings-header {
        text-align: center;
        width: 100%;
      }

      .settings-title {
        font-size: 1.5rem;
        font-weight: 300;
        color: #ffffff;
        margin: 0 0 0.5rem 0;
        letter-spacing: 0.05em;
      }

      .settings-subtitle {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.4);
        letter-spacing: 0.1em;
        text-transform: uppercase;
        font-weight: 200;
      }

      .settings-list {
        width: 100%;
        max-width: 400px;
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .settings-item {
        background: rgba(78, 140, 135, 0.08);
        border: 1px solid rgba(78, 140, 135, 0.15);
        border-radius: 8px;
        padding: 1rem 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .settings-label {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.7);
        letter-spacing: 0.02em;
        margin: 0;
        font-weight: 300;
      }

      .toggle-switch {
        width: 48px;
        height: 28px;
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 14px;
        cursor: pointer;
        position: relative;
        transition: all 0.3s ease;
        padding: 0;
        display: flex;
        align-items: center;
        padding: 2px;
      }

      .toggle-switch.active {
        background: #4e8c87;
        border-color: #4e8c87;
      }

      .toggle-thumb {
        width: 24px;
        height: 24px;
        background: #ffffff;
        border-radius: 12px;
        transition: all 0.3s ease;
        position: absolute;
        left: 2px;
      }

      .toggle-switch.active .toggle-thumb {
        left: 22px;
      }

      #instructions-screen {
        background: linear-gradient(
          165deg,
          #0f1720 0%,
          #1e2a38 50%,
          #2a3f50 100%
        );
      }

      .instructions-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        width: 100%;
        gap: 2rem;
        padding: 2rem;
      }

      .instructions-header {
        text-align: center;
        width: 100%;
      }

      .instructions-title {
        font-size: 1.5rem;
        font-weight: 300;
        color: #ffffff;
        margin: 0 0 0.5rem 0;
        letter-spacing: 0.05em;
      }

      .instructions-subtitle {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.4);
        letter-spacing: 0.1em;
        text-transform: uppercase;
        font-weight: 200;
      }

      .instructions-list {
        width: 100%;
        max-width: 450px;
        display: flex;
        flex-direction: column;
        gap: 1.2rem;
        margin-bottom: 1rem;
      }

      .instruction-card {
        background: rgba(78, 140, 135, 0.08);
        border: 1px solid rgba(78, 140, 135, 0.15);
        border-radius: 12px;
        padding: 1.5rem;
        display: flex;
        gap: 1.2rem;
        transition: all 0.3s ease;
      }

      .instruction-card:hover {
        background: rgba(78, 140, 135, 0.12);
        border-color: rgba(78, 140, 135, 0.25);
        transform: translateX(4px);
      }

      .instruction-number {
        width: 40px;
        height: 40px;
        min-width: 40px;
        background: linear-gradient(135deg, #4e8c87 0%, #c9c7e8 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        font-weight: 300;
        color: #ffffff;
        text-align: center;
      }

      .instruction-text {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        flex: 1;
      }

      .instruction-heading {
        font-size: 0.95rem;
        font-weight: 400;
        color: #ffffff;
        margin: 0;
        letter-spacing: 0.02em;
      }

      .instruction-description {
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.6);
        line-height: 1.6;
        margin: 0;
        letter-spacing: 0.01em;
      }
    </style>
    <style>
      @view-transition {
        navigation: auto;
      }
    </style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
    <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
  </head>
  <body class="h-full w-full">
    <div id="app-container" class="h-full w-full">
      <button id="menu-toggle" class="menu-toggle">
        <svg viewbox="0 0 24 24">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
      <div id="menu-overlay" class="menu-overlay"></div>
      <nav id="menu-sidebar" class="menu-sidebar">
        <div class="menu-header">
          <div class="menu-logo-section">
            <img
              src="https://raw.githubusercontent.com/alejandrabarcena/InnerRhythm/refs/heads/main/inner%20%20logo.png"
              alt="Inner Rhythm Logo"
              class="menu-logo"
              loading="lazy"
              onerror="console.error('Logo failed to load:', this.src); this.style.display='none';"
            />
            <h2 class="menu-title">Menú</h2>
          </div>
          <button id="menu-close" class="menu-close">
            <svg viewbox="0 0 24 24">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <ul class="menu-items">
          <li class="menu-item">
            <button class="menu-link active" data-screen="monitor">
              <svg class="menu-icon" viewbox="0 0 24 24">
                <path
                  d="M3 12c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v7c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2v-7z"
                />
                <path d="M12 9V3M9 5h6" /></svg
              ><span id="menu-monitor-text">Monitor</span>
            </button>
          </li>
          <li class="menu-item">
            <button class="menu-link" data-screen="breathe">
              <svg class="menu-icon" viewbox="0 0 24 24">
                <circle cx="12" cy="12" r="9"></circle>
                <path d="M12 7v10M17 12H7" /></svg
              ><span id="menu-breathing-text">Respiración</span>
            </button>
          </li>
          <li class="menu-item">
            <button class="menu-link" data-screen="stats">
              <svg class="menu-icon" viewbox="0 0 24 24">
                <rect x="3" y="13" width="4" height="8"></rect>
                <rect x="10" y="8" width="4" height="13"></rect>
                <rect x="17" y="3" width="4" height="18"></rect></svg
              ><span id="menu-stats-text">Estadísticas</span>
            </button>
          </li>
          <li class="menu-item">
            <button class="menu-link" data-screen="settings">
              <svg class="menu-icon" viewbox="0 0 24 24">
                <circle cx="12" cy="12" r="3"></circle>
                <path
                  d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m6.08 0l4.24-4.24M1 12h6m6 0h6m-14.78 7.78l4.24-4.24m6.08 0l4.24 4.24"
                /></svg
              ><span id="menu-settings-text">Configuración</span>
            </button>
          </li>
          <li class="menu-item">
            <button class="menu-link" data-screen="instructions">
              <svg class="menu-icon" viewbox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line></svg
              ><span id="menu-instructions-text">Instrucciones</span>
            </button>
          </li>
        </ul>
      </nav>
      <div id="monitor-screen" class="screen active">
        <div class="app-header">
          <img
            src="https://raw.githubusercontent.com/alejandrabarcena/InnerRhythm/refs/heads/main/inner%20%20logo.png"
            alt="Inner Rhythm Logo"
            class="app-logo"
            loading="lazy"
            onerror="console.error('Logo failed to load:', this.src); this.style.display='none';"
          />
          <h1 id="app-title" class="app-title">Inner Rhythm</h1>
        </div>
        <div class="pulse-container">
          <div class="pulse-ring"></div>
          <div class="pulse-ring"></div>
          <div class="pulse-ring"></div>
          <div class="pulse-circle">
            <svg class="pulse-icon" viewbox="0 0 24 24" fill="currentColor">
              <path
                d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
              />
            </svg>
          </div>
        </div>
        <div class="bpm-display">
          <p id="bpm-value" class="bpm-number">72</p>
          <p class="bpm-label">bpm</p>
        </div>
        <div class="state-indicator">
          <div id="state-dot" class="state-dot calm"></div>
          <p id="state-text" class="state-text">Calmado</p>
        </div>
        <button id="breathe-btn" class="breathe-btn">
          <svg class="breathe-icon" viewbox="0 0 24 24">
            <path d="M6 9h12M6 15h12M6 12h12" />
          </svg>
        </button>
      </div>
      <div id="breathe-screen" class="screen">
        <button id="back-btn" class="back-button">
          <svg class="back-icon" viewbox="0 0 24 24">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <p class="breathing-title">Encuentra tu ritmo</p>
        <div class="breathe-content">
          <div id="breathing-circle" class="breathing-circle">
            <div class="breathing-info">
              <p id="breathing-instruction" class="breathing-instruction">
                Prepárate
              </p>
              <p id="breathing-timer" class="breathing-timer">3</p>
            </div>
          </div>
          <div class="cycle-info">
            <div class="cycle-dots">
              <div id="dot-1" class="cycle-dot"></div>
              <div id="dot-2" class="cycle-dot"></div>
              <div id="dot-3" class="cycle-dot"></div>
              <div id="dot-4" class="cycle-dot"></div>
            </div>
            <p class="cycle-label">
              Ciclo <span id="cycle-number">1</span> de 4
            </p>
          </div>
          <p id="breathing-message" class="breathing-message">
            Tu cuerpo está aprendiendo a regularse
          </p>
        </div>
      </div>
      <div id="stats-screen" class="screen">
        <button id="back-stats-btn" class="back-button">
          <svg class="back-icon" viewbox="0 0 24 24">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <div class="stats-content">
          <div class="stats-header">
            <h2 class="stats-title">Estadísticas</h2>
            <p class="stats-subtitle">Esta semana</p>
          </div>
          <div class="stats-grid">
            <div class="stat-card">
              <p class="stat-value" id="stat-sessions">12</p>
              <p class="stat-label">Sesiones</p>
            </div>
            <div class="stat-card">
              <p class="stat-value" id="stat-minutes">48</p>
              <p class="stat-label">Minutos</p>
            </div>
            <div class="stat-card">
              <p class="stat-value" id="stat-avg-bpm">68</p>
              <p class="stat-label">BPM Promedio</p>
            </div>
            <div class="stat-card">
              <p class="stat-value" id="stat-streak">5</p>
              <p class="stat-label">Racha</p>
            </div>
          </div>
        </div>
      </div>
      <div id="settings-screen" class="screen">
        <button id="back-settings-btn" class="back-button">
          <svg class="back-icon" viewbox="0 0 24 24">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <div class="settings-content">
          <div class="settings-header">
            <h2 class="settings-title">Configuración</h2>
            <p class="settings-subtitle">Personaliza tu experiencia</p>
          </div>
          <ul class="settings-list">
            <li class="settings-item">
              <p class="settings-label">Notificaciones</p>
              <button class="toggle-switch active" id="toggle-notifications">
                <div class="toggle-thumb"></div>
              </button>
            </li>
            <li class="settings-item">
              <p class="settings-label">Vibraciones</p>
              <button class="toggle-switch" id="toggle-vibrations">
                <div class="toggle-thumb"></div>
              </button>
            </li>
            <li class="settings-item">
              <p class="settings-label">Sonidos</p>
              <button class="toggle-switch active" id="toggle-sounds">
                <div class="toggle-thumb"></div>
              </button>
            </li>
            <li class="settings-item">
              <p class="settings-label">Modo nocturno</p>
              <button class="toggle-switch" id="toggle-dark-mode">
                <div class="toggle-thumb"></div>
              </button>
            </li>
          </ul>
        </div>
      </div>
      <div id="instructions-screen" class="screen">
        <button id="back-instructions-btn" class="back-button">
          <svg class="back-icon" viewbox="0 0 24 24">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <div class="instructions-content">
          <div class="instructions-header">
            <h2 class="instructions-title">Cómo Usar</h2>
            <p class="instructions-subtitle">Guía de Inner Rhythm</p>
          </div>
          <div class="instructions-list">
            <div class="instruction-card">
              <div class="instruction-number">1</div>
              <div class="instruction-text">
                <h3 class="instruction-heading">Monitor tu Ritmo</h3>
                <p class="instruction-description">
                  Visualiza tu frecuencia cardíaca en tiempo real. El indicador
                  de estado cambia según tu nivel de calma o activación.
                </p>
              </div>
            </div>
            <div class="instruction-card">
              <div class="instruction-number">2</div>
              <div class="instruction-text">
                <h3 class="instruction-heading">Inicia la Respiración</h3>
                <p class="instruction-description">
                  Presiona el botón "Respirar" para comenzar con ejercicios
                  guiados de 4 ciclos. Sigue el ritmo del círculo.
                </p>
              </div>
            </div>
            <div class="instruction-card">
              <div class="instruction-number">3</div>
              <div class="instruction-text">
                <h3 class="instruction-heading">Ciclo de Respiración</h3>
                <p class="instruction-description">
                  Cada ciclo incluye: inhala (4s), sostén (4s), exhala (6s). Los
                  puntos indican tu progreso.
                </p>
              </div>
            </div>
            <div class="instruction-card">
              <div class="instruction-number">4</div>
              <div class="instruction-text">
                <h3 class="instruction-heading">Revisa Estadísticas</h3>
                <p class="instruction-description">
                  Accede a tu historial de sesiones, minutos totales, BPM
                  promedio y racha de consistencia.
                </p>
              </div>
            </div>
            <div class="instruction-card">
              <div class="instruction-number">5</div>
              <div class="instruction-text">
                <h3 class="instruction-heading">Personaliza tu Experiencia</h3>
                <p class="instruction-description">
                  Desde Configuración, activa/desactiva notificaciones,
                  vibraciones y sonidos según prefieras.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      const menuToggle = document.getElementById("menu-toggle");
      const menuOverlay = document.getElementById("menu-overlay");
      const menuSidebar = document.getElementById("menu-sidebar");
      const menuClose = document.getElementById("menu-close");
      const menuLinks = document.querySelectorAll(".menu-link");

      const screens = {
        monitor: document.getElementById("monitor-screen"),
        breathe: document.getElementById("breathe-screen"),
        stats: document.getElementById("stats-screen"),
        settings: document.getElementById("settings-screen"),
        instructions: document.getElementById("instructions-screen"),
      };

      const backButtons = {
        breathe: document.getElementById("back-btn"),
        stats: document.getElementById("back-stats-btn"),
        settings: document.getElementById("back-settings-btn"),
        instructions: document.getElementById("back-instructions-btn"),
      };

      let currentScreen = "monitor";

      function toggleMenu() {
        menuSidebar.classList.toggle("active");
        menuOverlay.classList.toggle("active");
        menuToggle.classList.toggle("open");
      }

      function closeMenu() {
        menuSidebar.classList.remove("active");
        menuOverlay.classList.remove("active");
        menuToggle.classList.remove("open");
      }

      function switchScreen(screenName) {
        if (currentScreen === "breathe" && screenName !== "breathe") {
          stopBreathing();
        }

        Object.values(screens).forEach((screen) =>
          screen.classList.remove("active")
        );
        screens[screenName].classList.add("active");
        currentScreen = screenName;

        menuLinks.forEach((link) => {
          link.classList.remove("active");
          if (link.dataset.screen === screenName) {
            link.classList.add("active");
          }
        });

        closeMenu();
      }

      menuToggle.addEventListener("click", toggleMenu);
      menuClose.addEventListener("click", closeMenu);
      menuOverlay.addEventListener("click", closeMenu);

      menuLinks.forEach((link) => {
        link.addEventListener("click", (e) => {
          e.preventDefault();
          const screenName = link.dataset.screen;
          switchScreen(screenName);
        });
      });

      backButtons.breathe.addEventListener("click", () =>
        switchScreen("monitor")
      );
      backButtons.stats.addEventListener("click", () =>
        switchScreen("monitor")
      );
      backButtons.settings.addEventListener("click", () =>
        switchScreen("monitor")
      );
      backButtons.instructions.addEventListener("click", () =>
        switchScreen("monitor")
      );

      document
        .getElementById("toggle-notifications")
        .addEventListener("click", function () {
          this.classList.toggle("active");
        });
      document
        .getElementById("toggle-vibrations")
        .addEventListener("click", function () {
          this.classList.toggle("active");
        });
      document
        .getElementById("toggle-sounds")
        .addEventListener("click", function () {
          this.classList.toggle("active");
        });
      document
        .getElementById("toggle-dark-mode")
        .addEventListener("click", function () {
          this.classList.toggle("active");
        });

      const defaultConfig = {
        app_title: "Inner Rhythm",
        monitor_state_calm: "Calmado",
        monitor_state_active: "Activado",
        breathing_title: "Encuentra tu ritmo",
        menu_monitor: "Monitor",
        menu_breathing: "Respiración",
        menu_stats: "Estadísticas",
        menu_settings: "Configuración",
        primary_color: "#0F1720",
        secondary_color: "#4E8C87",
        accent_color: "#C9C7E8",
        text_color: "#ffffff",
        tertiary_color: "#F2F4F6",
        font_family: "Outfit",
        font_size: 16,
      };

      let config = { ...defaultConfig };

      let currentBPM = 72;
      let breathingActive = false;
      let currentCycle = 1;
      let bpmInterval = null;

      const appTitle = document.getElementById("app-title");
      const bpmValue = document.getElementById("bpm-value");
      const stateDot = document.getElementById("state-dot");
      const stateText = document.getElementById("state-text");
      const breatheBtn = document.getElementById("breathe-btn");
      const monitorScreen = document.getElementById("monitor-screen");
      const breatheScreen = document.getElementById("breathe-screen");
      const breathingCircle = document.getElementById("breathing-circle");
      const breathingInstruction = document.getElementById(
        "breathing-instruction"
      );
      const breathingTimer = document.getElementById("breathing-timer");
      const cycleNumber = document.getElementById("cycle-number");
      const breathingMessage = document.getElementById("breathing-message");

      function simulateBPM() {
        const variation = (Math.random() - 0.5) * 8;
        currentBPM = Math.max(55, Math.min(110, currentBPM + variation));
        updateBPMDisplay();
      }

      function updateBPMDisplay() {
        bpmValue.textContent = Math.round(currentBPM);

        if (currentBPM < 75) {
          stateDot.className = "state-dot calm";
          stateText.textContent =
            config.monitor_state_calm || defaultConfig.monitor_state_calm;
        } else {
          stateDot.className = "state-dot active";
          stateText.textContent =
            config.monitor_state_active || defaultConfig.monitor_state_active;
        }
      }

      function startBPMSimulation() {
        if (bpmInterval) clearInterval(bpmInterval);
        bpmInterval = setInterval(simulateBPM, 2500);
      }

      function stopBPMSimulation() {
        if (bpmInterval) clearInterval(bpmInterval);
      }

      const messages = [
        "Tu cuerpo está aprendiendo a regularse",
        "Cada respiración te trae más calma",
        "Estás exactamente donde necesitas estar",
        "Tu ritmo es válido y aceptado",
      ];

      function startBreathing() {
        breathingActive = true;
        currentCycle = 1;
        updateCycleDots();
        cycleNumber.textContent = "1";

        breathingCircle.className = "breathing-circle";
        breathingInstruction.textContent = "Prepárate";
        breathingTimer.textContent = "3";
        breathingMessage.classList.remove("visible");

        let count = 3;
        const prepareInterval = setInterval(() => {
          count--;
          if (count > 0) {
            breathingTimer.textContent = count;
          } else {
            clearInterval(prepareInterval);
            runBreathingPhases();
          }
        }, 1000);
      }

      function runBreathingPhases() {
        if (!breathingActive) return;

        breathingCircle.className = "breathing-circle inhale";
        breathingInstruction.textContent = "Inhala";
        let inCount = 4;
        breathingTimer.textContent = inCount;

        const inInterval = setInterval(() => {
          inCount--;
          if (inCount > 0) {
            breathingTimer.textContent = inCount;
          } else {
            clearInterval(inInterval);

            breathingCircle.className = "breathing-circle";
            breathingInstruction.textContent = "Sostén";
            let holdCount = 4;
            breathingTimer.textContent = holdCount;

            const holdInterval = setInterval(() => {
              holdCount--;
              if (holdCount > 0) {
                breathingTimer.textContent = holdCount;
              } else {
                clearInterval(holdInterval);

                breathingCircle.className = "breathing-circle exhale";
                breathingInstruction.textContent = "Exhala";
                let exCount = 6;
                breathingTimer.textContent = exCount;

                const exInterval = setInterval(() => {
                  exCount--;
                  if (exCount > 0) {
                    breathingTimer.textContent = exCount;
                  } else {
                    clearInterval(exInterval);

                    if (currentCycle < 4) {
                      currentCycle++;
                      updateCycleDots();
                      cycleNumber.textContent = currentCycle;

                      const msg = messages[currentCycle - 2];
                      breathingMessage.textContent = msg;
                      breathingMessage.classList.add("visible");

                      setTimeout(() => {
                        if (breathingActive) runBreathingPhases();
                      }, 1500);
                    } else {
                      finishBreathing();
                    }
                  }
                }, 1000);
              }
            }, 1000);
          }
        }, 1000);
      }

      function finishBreathing() {
        breathingCircle.className = "breathing-circle";
        breathingInstruction.textContent = "✓";
        breathingTimer.textContent = "";

        breathingMessage.textContent =
          "Ejercicio completado. Tu ritmo está más calmado ahora.";
        breathingMessage.classList.add("visible");

        currentBPM = Math.max(60, currentBPM - 12);
        updateBPMDisplay();
      }

      function stopBreathing() {
        breathingActive = false;
        breathingMessage.classList.remove("visible");
      }

      function updateCycleDots() {
        for (let i = 1; i <= 4; i++) {
          const dot = document.getElementById(`dot-${i}`);
          if (i < currentCycle) {
            dot.className = "cycle-dot completed";
          } else if (i === currentCycle) {
            dot.className = "cycle-dot active";
          } else {
            dot.className = "cycle-dot";
          }
        }
      }

      breatheBtn.addEventListener("click", () => switchScreen("breathe"));

      async function onConfigChange(newConfig) {
        config = { ...defaultConfig, ...newConfig };

        appTitle.textContent = config.app_title || defaultConfig.app_title;

        document.getElementById("menu-monitor-text").textContent =
          config.menu_monitor || defaultConfig.menu_monitor;
        document.getElementById("menu-breathing-text").textContent =
          config.menu_breathing || defaultConfig.menu_breathing;
        document.getElementById("menu-stats-text").textContent =
          config.menu_stats || defaultConfig.menu_stats;
        document.getElementById("menu-settings-text").textContent =
          config.menu_settings || defaultConfig.menu_settings;

        const primaryColor =
          config.primary_color || defaultConfig.primary_color;
        const secondaryColor =
          config.secondary_color || defaultConfig.secondary_color;
        const accentColor = config.accent_color || defaultConfig.accent_color;

        monitorScreen.style.background = `linear-gradient(165deg, ${primaryColor} 0%, #1a2942 40%, #243456 70%, #2d3f5a 100%)`;
        screens.stats.style.background = `linear-gradient(165deg, ${primaryColor} 0%, #1E2A38 50%, #2A3F50 100%)`;
        screens.settings.style.background = `linear-gradient(165deg, ${primaryColor} 0%, #1E2A38 50%, #2A3F50 100%)`;
        screens.instructions.style.background = `linear-gradient(165deg, ${primaryColor} 0%, #1E2A38 50%, #2A3F50 100%)`;
        breatheScreen.style.background = `linear-gradient(165deg, ${primaryColor} 0%, #1a2840 40%, #243450 70%, #2a3a58 100%)`;

        const pulseCircle = document.querySelector(".pulse-circle");
        pulseCircle.style.background = `linear-gradient(135deg, ${secondaryColor} 0%, ${accentColor} 100%)`;
        breathingCircle.style.background = `linear-gradient(135deg, ${secondaryColor} 0%, ${accentColor} 100%)`;

        const fontFamily = config.font_family || defaultConfig.font_family;
        document.body.style.fontFamily = `'${fontFamily}', sans-serif`;

        const fontSize = config.font_size || defaultConfig.font_size;
        const ratio = fontSize / 16;
        document.documentElement.style.setProperty("--font-size-ratio", ratio);
      }

      function mapToCapabilities(config) {
        return {
          recolorables: [
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => {
                config.primary_color = value;
                window.elementSdk.setConfig({ primary_color: value });
              },
            },
            {
              get: () =>
                config.secondary_color || defaultConfig.secondary_color,
              set: (value) => {
                config.secondary_color = value;
                window.elementSdk.setConfig({ secondary_color: value });
              },
            },
            {
              get: () => config.accent_color || defaultConfig.accent_color,
              set: (value) => {
                config.accent_color = value;
                window.elementSdk.setConfig({ accent_color: value });
              },
            },
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            },
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            },
          },
        };
      }

      function mapToEditPanelValues(config) {
        return new Map([
          ["app_title", config.app_title || defaultConfig.app_title],
          [
            "monitor_state_calm",
            config.monitor_state_calm || defaultConfig.monitor_state_calm,
          ],
          [
            "monitor_state_active",
            config.monitor_state_active || defaultConfig.monitor_state_active,
          ],
          [
            "breathing_title",
            config.breathing_title || defaultConfig.breathing_title,
          ],
          ["menu_monitor", config.menu_monitor || defaultConfig.menu_monitor],
          [
            "menu_breathing",
            config.menu_breathing || defaultConfig.menu_breathing,
          ],
          ["menu_stats", config.menu_stats || defaultConfig.menu_stats],
          [
            "menu_settings",
            config.menu_settings || defaultConfig.menu_settings,
          ],
        ]);
      }

      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities,
          mapToEditPanelValues,
        });
        config = window.elementSdk.config || config;
      }

      onConfigChange(config);
      startBPMSimulation();
    </script>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'9c9f6cdca25ceddf',t:'MTc3MDQzMTAwNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener)
            document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState &&
                ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
